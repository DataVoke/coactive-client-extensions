{"version":3,"sources":["../../../src/api/internal/_apiUtils.js"],"names":["_apiUtils","context","api","utils","npmProviderUrl","supportsES6","Function","err","loadResource","url","resourceType","callback","rawContent","resourceTypeLC","toLowerCase","elementSourceProperty","createElement","elementKind","type","element","document","id","btoa","generateHash","newElement","indexOf","src","startsWith","href","rel","console","log","innerHTML","foundElement","getElementsByTagName","tagName","find","runFunction","readyState","onreadystatechange","onload","setTimeout","head","appendChild","value","toString","hash","i","length","charCodeAt","fn","thisArg","params","apply"],"mappings":";;;;;;;AAAA;;;;;;;;;;;;AAEA;AACe,SAASA,SAAT,CAAmBC,OAAnB,EAA4B;AACvC,wBAAKA,OAAL;AAEA,MAAI,CAACA,OAAO,CAACC,GAAR,CAAYC,KAAjB,EAAwBF,OAAO,CAACC,GAAR,CAAYC,KAAZ,GAAoB;AACxCC,IAAAA,cAAc,EAAE,oBADwB;AAExCC,IAAAA,WAAW,EAAE,uBAAM;AACf,UAAI;AACA,YAAIC,QAAJ,CAAa,cAAb;AACA,eAAO,IAAP;AACH,OAHD,CAGE,OAAOC,GAAP,EAAY;AACV,eAAO,KAAP;AACH;AACJ,KATuC;AAUxCC,IAAAA,YAAY,EAAE,sBAACC,GAAD,EAAMC,YAAN,EAAoBC,QAApB,EAA8BC,UAA9B,EAA6C;AACvD,UAAMC,cAAc,GAAGH,YAAY,CAACI,WAAb,EAAvB;AACA,UAAIC,qBAAqB,GAAG,IAA5B,CAFuD,CAGvD;;AACA,UAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,WAAD,EAAcC,IAAd,EAAuB;AACzC,YAAMC,OAAO,GAAGC,QAAQ,CAACJ,aAAT,CAAuBC,WAAvB,CAAhB;AACAE,QAAAA,OAAO,CAACD,IAAR,GAAeA,IAAf,CAFyC,CAGzC;;AACAC,QAAAA,OAAO,CAACE,EAAR,GAAapB,OAAO,CAACqB,IAAR,CAAab,GAAb,KAAqBP,GAAG,CAACC,KAAJ,CAAUoB,YAAV,CAAuBX,UAAvB,CAAlC;AACA,eAAOO,OAAP;AACH,OAND,CAJuD,CAYvD;;;AACA,UAAIK,UAAU,GAAG,IAAjB;;AACA,cAAQ,IAAR;AACI,aAAKX,cAAc,CAACY,OAAf,CAAuB,YAAvB,IAAuC,CAAC,CAAxC,IAA6CZ,cAAc,CAACY,OAAf,CAAuB,IAAvB,IAA+B,CAAC,CAAlF;AACID,UAAAA,UAAU,GAAGR,aAAa,CAAC,QAAD,EAAW,iBAAX,CAA1B;AACA,cAAIP,GAAJ,EAASe,UAAU,CAACE,GAAX,GAAiBjB,GAAjB;AACTM,UAAAA,qBAAqB,GAAG,KAAxB;AACA;;AAEJ,aAAKF,cAAc,CAACY,OAAf,CAAuB,KAAvB,IAAgC,CAAC,CAAtC;AACID,UAAAA,UAAU,GAAGR,aAAa,CAAC,QAAD,EAAW,iBAAX,CAA1B;AACAQ,UAAAA,UAAU,CAACE,GAAX,GAAiB,MAAMjB,GAAG,CAACkB,UAAJ,CAAe,SAAf,KAA6BlB,GAAG,CAACkB,UAAJ,CAAe,UAAf,CAA7B,GAA0D,EAA1D,GAA+DzB,GAAG,CAACC,KAAJ,CAAUC,cAA/E,IAAiGK,GAAlH;AACAM,UAAAA,qBAAqB,GAAG,KAAxB;AACA;;AAEJ,aAAKF,cAAc,CAACY,OAAf,CAAuB,YAAvB,IAAuC,CAAC,CAAxC,IAA6CZ,cAAc,CAACY,OAAf,CAAuB,KAAvB,IAAgC,CAAC,CAAnF;AACI,cAAIhB,GAAJ,EAAS;AACLe,YAAAA,UAAU,GAAGR,aAAa,CAAC,MAAD,EAAS,UAAT,CAA1B;AACAQ,YAAAA,UAAU,CAACI,IAAX,GAAkBnB,GAAlB;AACAe,YAAAA,UAAU,CAACK,GAAX,GAAiB,YAAjB;AACAd,YAAAA,qBAAqB,GAAG,MAAxB;AACH,WALD,MAKO,IAAIH,UAAJ,EAAgB;AACnBY,YAAAA,UAAU,GAAGR,aAAa,CAAC,OAAD,EAAU,UAAV,CAA1B;AACAD,YAAAA,qBAAqB,GAAG,cAAxB;AACH;;AACD;;AAEJ;AACIe,UAAAA,OAAO,CAACC,GAAR,CAAY,4BAA4BrB,YAA5B,GAA2C,6CAAvD;AACA;AA3BR;;AA8BA,UAAIc,UAAJ,EAAgB;AACZ;AACA,YAAIZ,UAAJ,EAAgBY,UAAU,CAACQ,SAAX,GAAuBpB,UAAvB,CAFJ,CAGZ;;AACA,YAAMqB,YAAY,GAAG,mBAAIb,QAAQ,CAACc,oBAAT,CAA8BV,UAAU,CAACW,OAAzC,CAAJ,EAChBC,IADgB,CACX,UAAAjB,OAAO;AAAA,iBAAIA,OAAO,CAACD,IAAR,KAAiBM,UAAU,CAACN,IAA5B,IAAoCC,OAAO,CAACJ,qBAAD,CAAP,KAAmCN,GAA3E;AAAA,SADI,CAArB;;AAEA,YAAIwB,YAAJ,EAAkB;AACd;AACAT,UAAAA,UAAU,GAAGS,YAAb;AACA/B,UAAAA,GAAG,CAACC,KAAJ,CAAUkC,WAAV,CAAsB1B,QAAtB;AACH,SAJD,MAIO;AACH;AACA,cAAIa,UAAU,CAACc,UAAf,EAA2B;AACvB;AACAd,YAAAA,UAAU,CAACe,kBAAX,GAAgC,YAAY;AACxC,kBAAIf,UAAU,CAACc,UAAX,KAA0B,QAA1B,IAAsCd,UAAU,CAACc,UAAX,KAA0B,UAApE,EAAgF;AAC5Ed,gBAAAA,UAAU,CAACe,kBAAX,GAAgC,IAAhC;AACArC,gBAAAA,GAAG,CAACC,KAAJ,CAAUkC,WAAV,CAAsB1B,QAAtB;AACH;AACJ,aALD;AAMH,WARD,MAQO,IAAIF,GAAJ,EAAS;AACZ;AACAe,YAAAA,UAAU,CAACgB,MAAX,GAAoB,YAAY;AAC5BtC,cAAAA,GAAG,CAACC,KAAJ,CAAUkC,WAAV,CAAsB1B,QAAtB;AACH,aAFD;AAGH,WALM,MAKA,IAAIC,UAAJ,EAAgB;AACnB;AACAX,YAAAA,OAAO,CAACwC,UAAR,CAAmB,YAAW;AAC1BvC,cAAAA,GAAG,CAACC,KAAJ,CAAUkC,WAAV,CAAsB1B,QAAtB;AACH,aAFD;AAGH,WApBE,CAsBH;;;AACAS,UAAAA,QAAQ,CAACsB,IAAT,CAAcC,WAAd,CAA0BnB,UAA1B;AACH;AACJ;;AACD,aAAOA,UAAP;AACH,KA3FuC;AA4FxCD,IAAAA,YAAY,EAAE,sBAACqB,KAAD,EAAW;AACrB,UAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC3BA,QAAAA,KAAK,GAAGA,KAAK,CAACC,QAAN,EAAR;AACH;;AACD,UAAIC,IAAI,GAAG,IAAX;AACA,UAAIC,CAAC,GAAGH,KAAK,CAACI,MAAd;;AACA,aAAMD,CAAN,EAAS;AACLD,QAAAA,IAAI,GAAIA,IAAI,GAAG,EAAR,GAAcF,KAAK,CAACK,UAAN,CAAiB,EAAEF,CAAnB,CAArB;AACH;AACD;;;;;AAGA,aAAOD,IAAI,KAAK,CAAhB;AACH,KAzGuC;AA0GxCT,IAAAA,WAAW,EAAE,qBAACa,EAAD,EAAKC,OAAL,EAAcC,MAAd,EAAyB;AAClC,UAAIF,EAAE,IAAI,OAAOA,EAAP,KAAc,UAAxB,EAAoC;AAChC,eAAOA,EAAE,CAACG,KAAH,CAASF,OAAO,IAAIlD,OAApB,EAA6BmD,MAA7B,CAAP;AACH;AACJ;AA9GuC,GAApB;AAgH3B","sourcesContent":["import _api from './_api';\n\n// Coactive framework dependencies (will already be present when running in context of a Coactive environment)\nexport default function _apiUtils(context) {\n    _api(context);\n\n    if (!context.api.utils) context.api.utils = {\n        npmProviderUrl: \"https://unpkg.com/\",\n        supportsES6: () => {\n            try {\n                new Function(\"(a = 0) => a\");\n                return true;\n            } catch (err) {\n                return false;\n            }\n        },\n        loadResource: (url, resourceType, callback, rawContent) => {\n            const resourceTypeLC = resourceType.toLowerCase();\n            let elementSourceProperty = null;\n            // Function to create a new element of the specified kind\n            const createElement = (elementKind, type) => {\n                const element = document.createElement(elementKind);\n                element.type = type;\n                // Generate what should be a unique ID based on the URL/raw content\n                element.id = context.btoa(url) || api.utils.generateHash(rawContent);\n                return element;\n            };\n\n            // Create an element of the appropriate kind based on the resource type specified (JS or CSS)\n            let newElement = null;\n            switch (true) {\n                case resourceTypeLC.indexOf(\"javascript\") > -1 || resourceTypeLC.indexOf(\"js\") > -1:\n                    newElement = createElement(\"script\", \"text/javascript\");\n                    if (url) newElement.src = url;\n                    elementSourceProperty = \"src\";\n                    break;\n\n                case resourceTypeLC.indexOf(\"npm\") > -1:\n                    newElement = createElement(\"script\", \"text/javascript\");\n                    newElement.src = \"\" + (url.startsWith(\"http://\") || url.startsWith(\"https://\") ? \"\" : api.utils.npmProviderUrl) + url;\n                    elementSourceProperty = \"src\";\n                    break;\n\n                case resourceTypeLC.indexOf(\"stylesheet\") > -1 || resourceTypeLC.indexOf(\"css\") > -1:\n                    if (url) {\n                        newElement = createElement(\"link\", \"text/css\");\n                        newElement.href = url;\n                        newElement.rel = \"stylesheet\";\n                        elementSourceProperty = \"href\";\n                    } else if (rawContent) {\n                        newElement = createElement(\"style\", \"text/css\");\n                        elementSourceProperty = \"xxx-not-used\";\n                    }\n                    break;\n\n                default:\n                    console.log(\"WARNING: resourceType [\" + resourceType + \"] not supported for api.utils.loadResource.\");\n                    break;\n            }\n\n            if (newElement) {\n                // Inject raw content if any provided\n                if (rawContent) newElement.innerHTML = rawContent;\n                // Prevent duplicate loading of the same resource and type\n                const foundElement = [...document.getElementsByTagName(newElement.tagName)]\n                    .find(element => element.type === newElement.type && element[elementSourceProperty] === url);\n                if (foundElement) {\n                    // Just call back if such an element was already loaded\n                    newElement = foundElement;\n                    api.utils.runFunction(callback);\n                } else {\n                    // Set up appropriate event handler to call back when the element has been loaded\n                    if (newElement.readyState) {\n                        //IE\n                        newElement.onreadystatechange = function () {\n                            if (newElement.readyState === \"loaded\" || newElement.readyState === \"complete\") {\n                                newElement.onreadystatechange = null;\n                                api.utils.runFunction(callback);\n                            }\n                        };\n                    } else if (url) {\n                        //Others\n                        newElement.onload = function () {\n                            api.utils.runFunction(callback);\n                        };\n                    } else if (rawContent) {\n                        // Only raw content was provided, so just wait a tick and call back\n                        context.setTimeout(function() {\n                            api.utils.runFunction(callback);\n                        });\n                    }\n\n                    // Add the new element to the document\n                    document.head.appendChild(newElement);\n                }\n            }\n            return newElement;\n        },\n        generateHash: (value) => {\n            if (typeof value !== \"string\") {\n                value = value.toString();\n            }\n            let hash = 5381;\n            let i = value.length;\n            while(i) {\n                hash = (hash * 33) ^ value.charCodeAt(--i);\n            }\n            /* JavaScript does bitwise operations (like XOR, above) on 32-bit signed\n           * integers. Since we want the results to be always positive, convert the\n           * signed int to an unsigned by doing an unsigned bitshift. */\n            return hash >>> 0;\n        },\n        runFunction: (fn, thisArg, params) => {\n            if (fn && typeof fn === \"function\") {\n                return fn.apply(thisArg || context, params);\n            }\n        },\n    }\n}\n"],"file":"_apiUtils.js"}