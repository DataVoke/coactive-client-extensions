{"version":3,"sources":["../../src/api/designer.js"],"names":["api","loadExtension","utils","loadResource","designer","diff","app","dv","cache","views","allOriginalViews","Values","map","original","modified","allViews","getVal","ViewID","name","Name","type","window","jsondiffpatch","getActiveJavascriptEditor","Array","from","userWorkspace","windowManager","_windows","values","find","w","constructor","search","searchTerm","matches","forEach","view","Definition","ViewMacros","task","Actions","action","Settings","Object","keys","key","contains","push","reset","bindingsRegistry","bindings","clear","openForms","allOpenForms","form","raw","runFunction","closeWindow","session","startupView"],"mappings":"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","sourcesContent":["/**\n * Extends the api.designer namespace with additional helper functions.\n * Dependencies:\n *    api.loadExtension\n *    api.bindingsRegistry\n *    api.utils.loadResource\n *    api.utils.runFunction\n */\napi.loadExtension(\"api.designer\", () => {\n    api.utils.loadResource(\"jsondiffpatch\", \"npm\", () => {\n        api.designer.diff = () => {\n            return app.dv.cache.views.allOriginalViews.Values.map(original => {\n                const modified = app.dv.cache.views.allViews.getVal(original.ViewID);\n                return {\n                    name: original.Name,\n                    type: \"Form\",\n                    original,\n                    modified,\n                    diff: window.jsondiffpatch.diff(original,\n                                                    modified)\n                };\n            });\n        }\n    });\n\n    api.designer.getActiveJavascriptEditor = () => {\n        return Array.from(app.dv.userWorkspace.windowManager._windows.values()).find(w =>\n                                                                                     w.constructor.name === \"JavascriptEditor\" ||\n                                                                                     w.constructor.name === \"ExpressionEditor\" ||\n                                                                                     w.constructor.name === \"CodeActionEditorWindow\" ||\n                                                                                     w.constructor.name === \"CodeEndpointEditorWindow\");\n    };\n\n    api.designer.search = (searchTerm) => {\n        const matches = [];\n        app.dv.cache.views.allViews.Values.forEach(view => {\n            view.Definition.ViewMacros.forEach(task => {\n                task.Actions.forEach(action => {\n                    if (action.Settings) {\n                        Object.keys(action.Settings).forEach(key => {\n                            if (action.Settings[key] && action.Settings[key].contains && action.Settings[key].contains(searchTerm)) {\n                                matches.push({\n                                    view,\n                                    task,\n                                    action,\n                                    key,\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n        });\n        return matches;\n    };\n\n    api.designer.reset = () => {\n        // Clear bindings registry\n        api.bindingsRegistry.bindings.clear();\n        // Close all open forms\n        api.openForms.allOpenForms().forEach(form => {\n            if (form && form.raw && form.raw.window) {\n                api.utils.runFunction(form.raw.window.closeWindow, form.raw.window);\n            }\n        });\n        // Run startup sequence\n        app.dv.cache.session.startupView();\n    };\n});\n"],"file":"designer.js"}